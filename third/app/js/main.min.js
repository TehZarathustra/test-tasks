var audioPlayer={globals:{allTracks:[],playlist:[],temporarySearchPlaylist:[],i:0,lastPlayed:[],timer:0},dragAndDrop:function(){var a=$(".overlay"),e=this;$(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),a.removeClass("hidden")}),a.on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),a.addClass("hidden")}),a.on("dragover",function(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy"}),a.on("drop",function(i){i.stopPropagation(),i.preventDefault();for(var t=i.originalEvent.dataTransfer.files,n=0;n<t.length;n++)t[n].type.match(/audio\/(mp3|mpeg)/)&&e.getMetaData(t[n],function(a){e.globals.allTracks.push(a),e.globals.playlist.push(a),$(".playList").append($(e.playListHTML(a,e.globals.playlist.length-1))),e.controls.updateList(e.globals.playlist.length-1,a)});e.globals.allTracks.length&&(temporarySearchPlaylist=[]),a.addClass("hidden")})},getMetaData:function(a,e){var i=this;i.getTags(a,function(i){i.audioTrack=a,i.playing=!1,e(i),$(".description").css("display","none")})},getTags:function(a,e){var i=this,t={};ID3.loadTags(a.name,function(){var n=ID3.getAllTags(a.name);t.artist=n.artist||"Unknown Artist",t.title=n.title||"Unknown",t.album=n.album||"",n.picture&&n.picture.data&&n.picture.data.length?(t.picture=n.picture,i.getImageSource(t.picture,function(a){t.picture=a,e(t)})):(t.picture="../app/img/default.png",e(t))},{tags:["artist","title","album","picture"],dataReader:FileAPIReader(a)})},getImageSource:function(a,e){for(var i="",t=0;t<a.data.length;t++)i+=String.fromCharCode(a.data[t]);e("data:"+a.format+";base64,"+window.btoa(i))},readFile:function(a,e){var i=new FileReader;i.onload=function(a){e(a)},i.readAsDataURL(a)},playListHTML:function(a,e){var i='<li class="track';return a.playing&&(i+=" active"),i+='" data-index="'+e+'"><span class="songOverlay"><i class="fa fa-play"></i></span><div class="image"><img src="'+a.picture+'"/></div><div class="text"><p class="title">'+a.title+'</p><p class="song">'+a.artist+"</p>"},activeSongHtml:function(a){var e='\n		<div class="playerBox">\n		<div class="image">\n			<img src="'+a.picture+'"/>\n		</div>\n		<div class="song" id="song">\n			<div class="songName">'+a.artist+" â€” "+a.title+'</div>\n			<div class="controls">\n				<div title="Equalizer"><i class="fa fa-sliders"></i></div>\n				<div title="Play"><i class="fa fa-play"></i></div>\n				<div title="Stop"><i class="fa fa-stop"></i></div>\n			</div>\n			<canvas id="wave" width="649" height="150"></canvas>\n		</div>\n		</div>';return e},playSong:function(a,e){this.globals.audio.pause(),this.globals.audio=new Audio;var i=audioPlayer.globals.audio,t=a.audioTrack,n=URL.createObjectURL(t);i.src=n,i.controls=!0,i.autoplay=!0,$(".songContainer").html(this.activeSongHtml(a)),i.play(),this.controls.stopTrack(),this.controls.playTrack(),this.controls.showEq(),this.globals.i=e,i.addEventListener("ended",function(){l(e)},!1),document.title=a.artist+" - "+a.title,this.visualizer(i,a);var l=function(){var a=audioPlayer.globals.i,e=audioPlayer.globals.allTracks;e.length>1&&(e[a+1]?(e=e[a+1],a++):(e=e[0],a=0),audioPlayer.playSong(e,a))}},visualizer:function(a,e){function i(){r=p.createAnalyser(),n=document.getElementById("wave"),l=n.getContext("2d"),o=p.createMediaElementSource(a),audioPlayer.globals.sourceNode=o,o.connect(r),r.connect(p.destination),t()}function t(){var a=l.createLinearGradient(0,0,0,300);a.addColorStop(1,"#ff7c00"),a.addColorStop(.75,"#c15b1a"),a.addColorStop(.25,"#71303b"),a.addColorStop(0,"#fe7c00"),window.requestAnimationFrame(t),s=new Uint8Array(r.frequencyBinCount),r.getByteFrequencyData(s),l.clearRect(0,0,n.width,n.height),l.clearRect(0,0,1e3,325),l.fillStyle=a,c=230;for(var e=0;c>e;e++)d=3*e,u=2,g=-(s[e]/2),l.fillRect(d,n.height,u,g)}var n,l,o,r,s,c,d,u,g,p=this.globals.context;i(),this.eq.initEq(),this.eq.reset()},eq:{initEq:function(){var a=audioPlayer.globals.context,e=audioPlayer.globals.sourceNode,i=-40,t=[360,3600],n=a.createBiquadFilter();n.type="lowshelf",n.frequency.value=t[0],n.gain.value=i;var l=a.createGain();l.gain.value=-1;var o=a.createGain(),r=a.createBiquadFilter();r.type="highshelf",r.frequency.value=t[1],r.gain.value=i;var s=a.createGain();s.gain.value=-1,e.connect(r),e.connect(o),e.connect(n),n.connect(l),r.connect(s),l.connect(o),s.connect(o),audioPlayer.globals.lGain=a.createGain(),audioPlayer.globals.mGain=a.createGain(),audioPlayer.globals.hGain=a.createGain(),r.connect(audioPlayer.globals.lGain),o.connect(audioPlayer.globals.mGain),n.connect(audioPlayer.globals.hGain);var c=a.createGain();audioPlayer.globals.lGain.connect(c),audioPlayer.globals.mGain.connect(c),audioPlayer.globals.hGain.connect(c),c.connect(a.destination)},update:function(a,e){var i=parseFloat(a)/100;switch(e){case"lowGain":audioPlayer.globals.lGain.gain.value=i;break;case"midGain":audioPlayer.globals.mGain.gain.value=i;break;case"highGain":audioPlayer.globals.hGain.gain.value=i}},reset:function(){$('.controls input[type="range"]').val(50),audioPlayer.globals.lGain.gain.value=.5,audioPlayer.globals.mGain.gain.value=.5,audioPlayer.globals.hGain.gain.value=.5},presets:function(a){function e(a){for(var e=0;e<a.length;e++){c[e].val(a[e]);var i=parseFloat(a[e])/100;d[e].value=i}}var i=["60","50","60"],t=["70","45","65"],n=["50","65","65"],l=["70","45","65"],t=["70","45","55"],o=["50","50","50"],r=["0","0","0"],s=["100","100","100"],c=[$(".lgain"),$(".mgain"),$(".hgain")],d=[audioPlayer.globals.lGain.gain,audioPlayer.globals.mGain.gain,audioPlayer.globals.hGain.gain];switch(a){case"rock":e(i);break;case"pop":e(t);break;case"jazz":e(n);break;case"classical":e(l);break;case"normal":e(o);break;case"lowest":e(r);break;case"highest":e(s)}}},controls:{updateList:function(a,e){$("[data-index='"+a+"']").click(function(){$(this);e.playing||audioPlayer.playSong(e,a)})},stopTrack:function(){$(".fa-stop").click(function(){audioPlayer.globals.audio.pause(),audioPlayer.globals.audio.currentTime=0})},playTrack:function(){$(".playerBox .fa-play").click(function(){audioPlayer.globals.audio.play()})},showEq:function(){$(".playerBox .fa-sliders").click(function(){var a=$(".eq");a.hasClass("active")?a.removeClass("active"):a.addClass("active")})}},init:function(){this.dragAndDrop(),this.globals.audio=new Audio,this.globals.context=new AudioContext}};audioPlayer.init();